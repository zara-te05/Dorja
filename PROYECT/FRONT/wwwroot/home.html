<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dorja - Aprende Programación</title>
    <link href="css/output.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .animate-shimmer {
            animation: shimmer 2s infinite;
        }
    </style>
</head>

<body
    class="bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300 antialiased overflow-y-auto scroll-smooth">
    <!-- NAVBAR -->
    <nav
        class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-slate-700 shadow sticky top-0 z-40">
        <div class="container mx-auto px-6 py-3 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="w-11 h-11 bg-indigo-600 rounded-lg flex items-center justify-center shadow-md">

                </div>
                <div>
                    <h1 class="text-lg sm:text-2xl font-extrabold text-gray-900 dark:text-white leading-tight">Dorja
                    </h1>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Aprende. Practica. Crece.</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="hidden sm:block">
                    <input aria-label="Buscar" type="search" placeholder="Buscar cursos, retos..."
                        class="w-64 px-3 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white/60 dark:bg-slate-800/60 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-400" />
                </div>

                <div class="relative">
                    <button id="notifications-button"
                        class="p-2.5 rounded-full transition-all duration-300 hover:bg-gray-100 dark:hover:bg-slate-800 relative group">
                        <i
                            class="fas fa-bell text-gray-600 dark:text-gray-300 text-lg group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors"></i>
                        <span id="notifications-count"
                            class="absolute -top-0.5 -right-0.5 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center shadow-lg ring-2 ring-white dark:ring-slate-900 animate-pulse">3</span>
                    </button>

                    <!-- NOTIFICATIONS MENU -->
                    <div id="notifications-menu"
                        class="hidden absolute right-0 mt-3 w-[600px] bg-white dark:bg-slate-800 rounded-xl shadow-lg z-30 border border-gray-200 dark:border-slate-700 overflow-hidden">
                        <div
                            class="px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-md">
                                    <i class="fas fa-bell text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900 dark:text-white text-lg">Notificaciones</h3>
                                    <p id="notifications-subtitle" class="text-xs text-gray-500 dark:text-gray-400">3
                                        nuevas</p>
                                </div>
                            </div>
                            <button id="mark-all-read-btn"
                                class="text-xs font-semibold text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 transition-colors px-3 py-1.5 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/30">
                                Marcar todas
                            </button>
                        </div>
                        <div id="notifications-list" class="max-h-[500px] overflow-y-auto">
                            <!-- Notificaciones se cargarán aquí dinámicamente -->
                            <div class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                <div
                                    class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                                    <i class="fas fa-bell-slash text-2xl opacity-50"></i>
                                </div>
                                <p class="text-sm font-medium">No hay notificaciones</p>
                                <p class="text-xs mt-1 opacity-75">Todas tus notificaciones aparecerán aquí</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative">
                    <button id="user-menu-button"
                        class="flex items-center gap-3 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition">
                        <div class="h-9 w-9 rounded-full bg-indigo-500 flex items-center justify-center shadow-sm">
                            <img class="h-9 w-9 rounded-full object-cover" src="" alt="Avatar" />
                        </div>
                        <div class="hidden sm:block text-left">
                            <div id="username-display" class="font-medium text-sm text-gray-700 dark:text-gray-300">
                                Cargando...</div>
                            <div class="text-xs text-gray-400">Nivel 1 · Principiante</div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 hidden sm:block"></i>
                    </button>

                    <!-- MENU -->
                    <div id="user-menu"
                        class="hidden absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-lg z-30 border border-gray-200 dark:border-slate-700 overflow-hidden">
                        <a href="profile.html"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700">
                            <i class="fas fa-user text-gray-500 w-5"></i>
                            Perfil
                        </a>
                        <a href="niveles.html"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700">
                            <i class="fas fa-route text-gray-500 w-5"></i>
                            Roadmap de Niveles
                        </a>
                        <div class="border-t border-gray-100 dark:border-slate-700"></div>
                        <button id="theme-toggle-btn"
                            class="w-full flex items-center gap-3 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700">
                            <i id="theme-icon" class="fas fa-moon text-gray-500 w-5"></i>
                            <span id="theme-text">Modo Oscuro</span>
                        </button>
                        <div class="border-t border-gray-100 dark:border-slate-700"></div>
                        <a href="#" id="logout-button"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-500/10">
                            <i class="fas fa-sign-out-alt w-5"></i>
                            Cerrar Sesión
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto mt-8 px-4 sm:px-6 lg:px-8 pb-32 min-h-screen">
        <!-- HERO -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-10 items-start mb-20">
            <div
                class="mb-6 lg:col-span-2 bg-gradient-to-r from-indigo-50 to-white dark:from-slate-800/40 dark:to-slate-900/40 rounded-xl p-8 lg:p-10 shadow-md border border-gray-100 dark:border-slate-700">
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-6 sm:gap-8 mb-10">
                    <div
                        class="w-32 h-32 sm:w-36 sm:h-36 rounded-2xl bg-indigo-500 flex items-center justify-center shadow-lg flex-shrink-0">
                        <img id="profile-photo" src="" alt="Foto de perfil"
                            class="w-full h-full rounded-2xl object-cover" />
                    </div>
                    <div class="flex-1">
                        <h2 class="text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white">Bienvenido, <span
                                id="user-firstname">Usuario</span></h2>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">Desbloqueaste <span
                                class="font-semibold text-indigo-600 dark:text-indigo-300">1</span> nivel · <span
                                class="font-semibold">100</span> puntos</p>




                        <div class="mt-6 flex flex-wrap gap-3 sm:gap-4">
                            <a href="Exercises.html"
                                class="inline-flex items-center gap-2 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:scale-[1.02] transition-transform">
                                <i class="fas fa-play"></i>
                                Continuar ejercicios
                            </a>



                            <a href="niveles.html"
                                class="inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:scale-[1.02] transition-transform">
                                <i class="fas fa-route"></i>
                                Ver Niveles
                            </a>
                        </div>
                    </div>
                </div>

                <div class="mt-10 grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-5">
                    <div
                        class="p-6 rounded-xl bg-gradient-to-br from-orange-50 via-red-50 to-orange-100 dark:from-orange-900/30 dark:via-red-900/20 dark:to-orange-900/30 border border-orange-200/50 dark:border-orange-800/50 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-20 h-20 bg-orange-200/20 dark:bg-orange-800/10 rounded-full -mr-10 -mt-10 blur-2xl group-hover:bg-orange-300/30 transition-colors">
                        </div>
                        <div class="relative z-10">
                            <p
                                class="text-xs font-medium text-orange-700 dark:text-orange-300 uppercase tracking-wide mb-3">
                                Racha</p>
                            <div class="flex items-center gap-3">
                                <div
                                    class="p-2.5 rounded-lg bg-gradient-to-br from-orange-400 to-red-500 shadow-md group-hover:scale-110 transition-transform duration-300">
                                    <i class="fas fa-fire text-white text-lg"></i>
                                </div>
                                <div>
                                    <span id="streak-days" class="font-bold text-2xl text-gray-900 dark:text-white">1</span>
                                    <span
                                        class="font-semibold text-base text-gray-700 dark:text-gray-300 ml-1">día</span>
                                </div>
                            </div>
                            <div class="mt-3 flex items-center gap-1">
                                <div class="flex gap-0.5">
                                    <i class="fas fa-fire text-orange-400 text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="p-6 rounded-xl bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 dark:from-indigo-900/30 dark:via-blue-900/20 dark:to-purple-900/30 border border-indigo-200/50 dark:border-indigo-800/50 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-20 h-20 bg-indigo-200/20 dark:bg-indigo-800/10 rounded-full -mr-10 -mt-10 blur-2xl group-hover:bg-indigo-300/30 transition-colors">
                        </div>
                        <div class="relative z-10">
                            <p
                                class="text-xs font-medium text-indigo-700 dark:text-indigo-300 uppercase tracking-wide mb-3">
                                Nivel</p>
                            <div class="flex items-center gap-3">
                                <div>
                                    <span class="font-bold text-2xl text-gray-900 dark:text-white">1</span>
                                    <span class="font-semibold text-sm text-gray-600 dark:text-gray-400 ml-2">·
                                        Principiante</span>
                                </div>
                            </div>
                            <div class="mt-3 flex items-center gap-1">
                                <div class="flex gap-1">
                                    <i class="fas fa-star text-indigo-400 text-xs"></i>
                                    <i class="fas fa-star text-indigo-400 text-xs"></i>
                                    <i class="fas fa-star text-indigo-400 text-xs"></i>
                                    <i class="fas fa-star text-indigo-400 text-xs"></i>
                                    <i class="fas fa-star text-indigo-400 text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="p-6 rounded-xl bg-gradient-to-br from-purple-50 via-indigo-50 to-pink-50 dark:from-purple-900/30 dark:via-indigo-900/20 dark:to-pink-900/30 border border-purple-200/50 dark:border-purple-800/50 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-20 h-20 bg-purple-200/20 dark:bg-purple-800/10 rounded-full -mr-10 -mt-10 blur-2xl group-hover:bg-purple-300/30 transition-colors">
                        </div>
                        <div class="relative z-10">
                            <p
                                class="text-xs font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wide mb-4">
                                Progreso</p>
                            <div class="mb-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span id="completion-percentage" class="font-bold text-xl text-gray-900 dark:text-white">10%</span>
                                    <span class="text-xs font-medium text-purple-600 dark:text-purple-400">Nivel
                                        1</span>
                                </div>
                                <div
                                    class="w-full bg-gray-200/60 dark:bg-slate-700/60 rounded-full h-3 overflow-hidden shadow-inner">
                                    <div id="completion-progress-bar" class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-3 rounded-full shadow-md relative overflow-hidden transition-all duration-500"
                                        style="width:10%">
                                        <div
                                            class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Random knowledge message -->
                <div
                    class="mt-10 rounded-lg p-6 lg:p-7 bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 border border-indigo-100 dark:border-indigo-800">
                    <div class="flex gap-4 items-start">
                        <div class="p-3 bg-indigo-500 rounded-lg text-white flex-shrink-0">
                            <i class="fas fa-lightbulb text-2xl"></i>
                        </div>
                        <div>
                            <p id="random-knowledge" class="text-gray-700 dark:text-gray-200">Aquí aparecerá un dato
                                curioso sobre programación.</p>
                            <div class="mt-2 text-xs text-gray-500">Consejo aleatorio para seguir aprendiendo</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: CARDS -->
            <aside class="space-y-6 lg:space-y-8">
                <div
                    class="mb-6 bg-white dark:bg-slate-800 rounded-xl p-6 lg:p-7 shadow-md border border-gray-100 dark:border-slate-700">
                    <h3 class="text-lg font-bold mb-6">Retos de Hoy</h3>
                    <ul class="space-y-5 text-sm">
                        <li class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Completa 5 ejercicios</div>
                                <div class="text-xs text-gray-500"></div>
                            </div>
                            <div class="w-20 h-3 bg-gray-200 rounded-full overflow-hidden ml-4">
                                <div class="h-3 bg-indigo-500" style="width:60%"></div>
                            </div>
                        </li>

                        <li class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Practica 20 minutos</div>
                                <div class="text-xs text-gray-500"></div>
                            </div>
                            <div class="w-20 h-3 bg-gray-200 rounded-full overflow-hidden ml-4">
                                <div class="h-3 bg-green-500" style="width:75%"></div>
                            </div>
                        </li>

                        
                    </ul>
                </div>

                <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 lg:p-7 text-white shadow-lg">
                    <h4 class="font-bold mb-3 text-lg">Próximo Nivel</h4>
                    <p class="text-sm opacity-90 mb-5">Nivel 2 · Patrones de Diseño</p>
                    <div class="mt-6">
                        <div class="text-xs flex justify-between"><span>0% completado</span><span>350 XP</span></div>
                        <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                            <div class="bg-white h-2 rounded-full" style="width:65%"></div>
                        </div>
                    </div>
                </div>
            </aside>
        </section>

        <!-- ACHIEVEMENTS -->
        <section class="mt-10 mb-10">
            <div
                class="bg-gradient-to-r from-indigo-50 to-white dark:from-slate-800/40 dark:to-slate-900/40 rounded-xl p-8 lg:p-10 shadow-md border border-gray-100 dark:border-slate-700">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-10">
                    <div>
                        <h3 class="text-2xl font-extrabold text-gray-900 dark:text-white">Logros Recientes</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Tus conquistas más destacadas</p>
                    </div>
                    <a href="#"
                        class="text-indigo-600 dark:text-indigo-400 text-sm font-semibold hover:text-indigo-700 dark:hover:text-indigo-300 transition-colors flex items-center gap-2">
                        Ver todos
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>

                <div id="achievements-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-4 sm:gap-5 lg:gap-6">
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400 col-span-full">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>Cargando logros...</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- SCRIPTS -->
    <script src="./api.js"></script>
    <script src="./js/achievements.js"></script>
    <script src="./js/renderer.js"></script>
    <script src="./js/dropdown.js"></script>
    <script src="./js/profile.js"></script>
    <script>
        // Visual-enhancement JS: theme toggle, greeting, random knowledge
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar autenticación
            const userId = sessionStorage.getItem('userId');
            if (!userId) {
                window.location.href = 'login.html';
                return;
            }

            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');

            // Theme helper
            const applyTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                if (themeIcon && themeText) {
                    if (isDark) {
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                        themeText.textContent = 'Modo Claro';
                    } else {
                        themeIcon.classList.remove('fa-sun');
                        themeIcon.classList.add('fa-moon');
                        themeText.textContent = 'Modo Oscuro';
                    }
                }
            };

            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(savedTheme ? savedTheme === 'dark' : prefersDark);

            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', () => {
                    applyTheme(!document.documentElement.classList.contains('dark'));
                });
            }

            // Greeting
            const hour = new Date().getHours();
            let greeting = 'Bienvenido';
            if (hour < 12) greeting = 'Buenos días';
            else if (hour < 18) greeting = 'Buenas tardes';
            else greeting = 'Buenas noches';
            const firstnameEl = document.getElementById('user-firstname');
            if (firstnameEl) firstnameEl.textContent = greeting.split(' ')[0];

            // Random knowledge array
            const facts = [
                'DRY: "Don\'t Repeat Yourself" — crea funciones reutilizables.',
                'Los comentarios claros son casi tan importantes como el código.',
                'Dividir problemas grandes en tareas pequeñas acelera el aprendizaje.',
                'Escribe pruebas pequeñas para asegurar comportamientos críticos.',
                'Los errores son oportunidades de aprendizaje: léelos con atención antes de buscar en Google.',
                'Console.log es tu amigo, pero aprende a usar el debugger del navegador.',
                'Nombra variables y funciones de forma descriptiva: prefiere "calculateTotalPrice" sobre "calc".',
                "Las IA's son tus amigas, pero tambien pueden ser tus mayores enemigas."
            ];
            const random = facts[Math.floor(Math.random() * facts.length)];
            const rk = document.getElementById('random-knowledge');
            if (rk) rk.textContent = random;

            // Load user statistics
            loadUserStats(userId);

            // Notifications functionality
            initializeNotifications();
        });

        // Load and display user statistics
        async function loadUserStats(userId) {
            try {
                const stats = await window.api.getUserStats(parseInt(userId));
                
                if (stats && stats.streak !== undefined && stats.completionPercentage !== undefined) {
                    // Update streak
                    const streakEl = document.getElementById('streak-days');
                    if (streakEl) {
                        streakEl.textContent = stats.streak || 0;
                    }

                    // Update completion percentage
                    const percentageEl = document.getElementById('completion-percentage');
                    const progressBarEl = document.getElementById('completion-progress-bar');
                    
                    if (percentageEl) {
                        const percentage = Math.round(stats.completionPercentage || 0);
                        percentageEl.textContent = percentage + '%';
                    }

                    if (progressBarEl) {
                        const percentage = Math.min(100, Math.max(0, stats.completionPercentage || 0));
                        progressBarEl.style.width = percentage + '%';
                    }
                }
            } catch (error) {
                console.error('Error loading user stats:', error);
                // Keep default values if there's an error
            }
        }

        function initializeNotifications() {
            const notificationsButton = document.getElementById('notifications-button');
            const notificationsMenu = document.getElementById('notifications-menu');
            const notificationsList = document.getElementById('notifications-list');
            const notificationsCount = document.getElementById('notifications-count');
            const markAllReadBtn = document.getElementById('mark-all-read-btn');

            // Sample notifications data
            let notifications = [
                {
                    id: 1,
                    type: 'achievement',
                    title: '¡Logro desbloqueado!',
                    message: 'Has completado 100 ejercicios',
                    time: 'Justo Ahora',
                    read: false,
                    icon: 'fa-trophy',
                    color: 'text-yellow-500'
                },
                {
                    id: 2,
                    type: 'level',
                    title: 'Nuevo nivel disponible',
                    message: 'Puedes acceder al Nivel 1',
                    time: 'Justo ahora',
                    read: false,
                    icon: 'fa-arrow-up',
                    color: 'text-indigo-500'
                },
                {
                    id: 3,
                    type: 'reminder',
                    title: 'Recordatorio',
                    message: 'No olvides practicar hoy para mantener tu racha',
                    time: 'Siempre',
                    read: false,
                    icon: 'fa-fire',
                    color: 'text-orange-500'
                }
            ];

            function renderNotifications() {
                const unreadCount = notifications.filter(n => !n.read).length;
                const subtitleEl = document.getElementById('notifications-subtitle');

                if (notificationsCount) {
                    if (unreadCount > 0) {
                        notificationsCount.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        notificationsCount.classList.remove('hidden');
                    } else {
                        notificationsCount.classList.add('hidden');
                    }
                }

                if (subtitleEl) {
                    if (unreadCount > 0) {
                        subtitleEl.textContent = `${unreadCount} ${unreadCount === 1 ? 'nueva' : 'nuevas'}`;
                        subtitleEl.classList.remove('hidden');
                    } else {
                        subtitleEl.textContent = 'Todo al día';
                        subtitleEl.classList.add('opacity-60');
                    }
                }

                if (notificationsList) {
                    if (notifications.length === 0) {
                        notificationsList.innerHTML = `
                            <div class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                                    <i class="fas fa-bell-slash text-2xl opacity-50"></i>
                                </div>
                                <p class="text-sm font-medium">No hay notificaciones</p>
                                <p class="text-xs mt-1 opacity-75">Todas tus notificaciones aparecerán aquí</p>
                            </div>
                        `;
                    } else {
                        notificationsList.innerHTML = notifications.map(notif => {
                            let iconBg = '';
                            let iconBorder = '';

                            if (notif.type === 'achievement') {
                                iconBg = 'bg-gradient-to-br from-yellow-400 to-orange-500';
                                iconBorder = 'border-yellow-300 dark:border-yellow-600';
                            } else if (notif.type === 'level') {
                                iconBg = 'bg-gradient-to-br from-indigo-500 to-purple-600';
                                iconBorder = 'border-indigo-300 dark:border-indigo-600';
                            } else {
                                iconBg = 'bg-gradient-to-br from-orange-400 to-red-500';
                                iconBorder = 'border-orange-300 dark:border-orange-600';
                            }

                            return `
                                <div class="group relative px-5 py-4 border-b border-gray-100 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700 transition-all duration-200 cursor-pointer ${notif.read ? 'opacity-70' : ''}" data-id="${notif.id}">
                                    ${!notif.read ? '<div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-indigo-500 to-purple-600 rounded-r-full"></div>' : ''}
                                    <div class="flex items-start gap-4">
                                        <div class="w-12 h-12 rounded-xl ${iconBg} flex items-center justify-center flex-shrink-0 shadow-md border-2 ${iconBorder} group-hover:scale-110 transition-transform duration-200">
                                            <i class="fas ${notif.icon} text-white text-base"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between gap-3 mb-1">
                                                <p class="font-bold text-sm text-gray-900 dark:text-white leading-tight">${notif.title}</p>
                                                ${!notif.read ? '<div class="w-2 h-2 bg-indigo-500 rounded-full flex-shrink-0 mt-1.5 animate-pulse"></div>' : ''}
                                            </div>
                                            <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed mb-2">${notif.message}</p>
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-clock text-xs text-gray-400 dark:text-gray-500"></i>
                                                <p class="text-xs text-gray-400 dark:text-gray-500 font-medium">${notif.time}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');

                        // Add click handlers
                        notificationsList.querySelectorAll('[data-id]').forEach(item => {
                            item.addEventListener('click', () => {
                                const id = parseInt(item.getAttribute('data-id'));
                                const notif = notifications.find(n => n.id === id);
                                if (notif && !notif.read) {
                                    notif.read = true;
                                    renderNotifications();
                                }
                            });
                        });
                    }
                }
            }

            // Get user menu elements for mutual closing
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenu = document.getElementById('user-menu');

            // Toggle notifications menu
            if (notificationsButton && notificationsMenu) {
                notificationsButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isHidden = notificationsMenu.classList.contains('hidden');
                    notificationsMenu.classList.toggle('hidden');

                    // Close user menu if notifications menu is being opened
                    if (!isHidden && userMenu && !userMenu.classList.contains('hidden')) {
                        userMenu.classList.add('hidden');
                    }
                });
            }

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (notificationsMenu && !notificationsMenu.contains(e.target) && !notificationsButton.contains(e.target)) {
                    notificationsMenu.classList.add('hidden');
                }
            });

            // Mark all as read
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', () => {
                    notifications.forEach(n => n.read = true);
                    renderNotifications();
                });
            }

            // Initial render
            renderNotifications();
        }
    </script>
</body>

</html>